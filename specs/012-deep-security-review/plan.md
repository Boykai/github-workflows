# Implementation Plan: Deep Security Review and Application Hardening

**Branch**: `012-deep-security-review` | **Date**: 2026-02-28 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/012-deep-security-review/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Conduct a comprehensive security audit across the full-stack web application (Python/FastAPI backend, React/TypeScript frontend, GitHub Actions CI). Harden GitHub Workflow files with SHA-pinned actions and least-privilege permissions. Remediate error message information leakage in backend API responses. Audit dependencies for known CVEs. Consolidate duplicated security logic into shared utilities. Produce a documented security findings report covering all issues, remediations, and accepted risks.

## Technical Context

**Language/Version**: Python 3.11+ (backend), TypeScript ~5.4 (frontend)
**Primary Dependencies**: FastAPI, Pydantic 2, httpx, aiosqlite (backend); React 18, TanStack Query, Vite (frontend)
**Storage**: SQLite via aiosqlite (existing — no schema changes required for security hardening)
**Testing**: pytest + pytest-asyncio (backend), Vitest + Testing Library (frontend), Playwright (e2e)
**Target Platform**: Linux server (Docker), browser SPA
**Project Type**: Web application (backend + frontend)
**Performance Goals**: N/A — security hardening must not degrade existing performance characteristics
**Constraints**: All changes must maintain backward compatibility; existing tests must continue to pass; no new dependencies unless strictly required for security remediation
**Scale/Scope**: ~20 source files (backend), ~30 source files (frontend), 1 GitHub Workflow file, 2 Dockerfiles, 1 docker-compose.yml

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Pre-Research (Gate 1)

| Principle | Status | Notes |
|-----------|--------|-------|
| **I. Specification-First** | PASS | `spec.md` complete with 7 prioritized user stories (P1-P3), acceptance scenarios, 14 FRs, edge cases, and measurable success criteria |
| **II. Template-Driven** | PASS | All artifacts created from canonical templates |
| **III. Agent-Orchestrated** | PASS | Plan generated by `/speckit.plan` agent, follows phase workflow |
| **IV. Test Optionality** | PASS | Tests not explicitly mandated in spec; existing tests must pass (SC-005, SC-010). Additional tests for new shared security modules may be added if consolidation occurs |
| **V. Simplicity and DRY** | PASS | Security hardening modifies existing files in-place. No new abstractions or projects added. Consolidation of duplicated logic follows DRY principle directly. Changes are surgical — pin actions, add permissions, fix error messages, update dependencies |

### Post-Design (Gate 2)

| Principle | Status | Notes |
|-----------|--------|-------|
| **I. Specification-First** | PASS | Spec complete. Plan, research, data model, contracts all derived from spec requirements |
| **II. Template-Driven** | PASS | All artifacts follow canonical templates |
| **III. Agent-Orchestrated** | PASS | Plan outputs are well-defined handoff artifacts for `/speckit.tasks` |
| **IV. Test Optionality** | PASS | No TDD requirement stated. Existing test suite serves as regression gate |
| **V. Simplicity and DRY** | PASS | No new projects, abstractions, or major refactors. Changes are file-level edits to existing code. Security logic already centralized — minor consolidation only where duplication exists |

All gates pass. No violations to justify.

## Project Structure

### Documentation (this feature)

```text
specs/012-deep-security-review/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
.github/
└── workflows/
    └── ci.yml                    # MODIFY — pin actions to SHAs, add permissions blocks

backend/
├── src/
│   ├── api/
│   │   └── auth.py               # MODIFY — sanitize error messages in OAuth and dev-login endpoints
│   ├── config.py                 # REVIEW — verify secure defaults documentation
│   ├── dependencies.py           # REVIEW — admin auto-promotion pattern
│   ├── exceptions.py             # REVIEW — error response sanitization
│   ├── main.py                   # REVIEW — generic exception handler, CORS config
│   ├── middleware/
│   │   └── request_id.py         # REVIEW — no changes expected
│   └── services/
│       ├── encryption.py          # REVIEW — Fernet encryption patterns
│       ├── github_auth.py         # REVIEW — OAuth state management, token handling
│       └── session_store.py       # REVIEW — session expiration, cookie flags
├── pyproject.toml                # REVIEW — dependency audit
└── tests/                        # REVIEW — ensure tests pass after changes

frontend/
├── package.json                  # REVIEW — dependency audit
├── src/
│   ├── services/
│   │   └── api.ts                # REVIEW — error handling patterns
│   └── components/               # REVIEW — no dangerouslySetInnerHTML usage
└── tests/                        # REVIEW — ensure tests pass after changes

docker-compose.yml                # REVIEW — secrets management via env vars
.env.example                      # REVIEW — placeholder values only
```

**Structure Decision**: Web application (backend + frontend). This is a security hardening feature — primarily modifying existing files in-place. No new directories or major structural changes. The CI workflow file and backend API auth module are the primary modification targets.

## Complexity Tracking

> No violations. All gates pass.
