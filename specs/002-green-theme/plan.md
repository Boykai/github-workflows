# Implementation Plan: Green Theme Option

**Branch**: `002-green-theme` | **Date**: 2026-02-14 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/002-green-theme/spec.md`

**Note**: This plan was generated by the `speckit.plan` workflow. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Add a green theme option to the application's theme selector, allowing users to choose from four total themes (Light, Dark, Green, Green Dark). The implementation extends the existing CSS custom property-based theme system with two new green theme variants that meet WCAG 2.1 Level AA accessibility standards. Theme selection applies instantly and persists across browser sessions using localStorage.

## Technical Context

**Language/Version**: TypeScript/React (existing frontend stack)  
**Primary Dependencies**: React hooks (useState, useEffect), CSS custom properties  
**Storage**: Browser localStorage (client-side preference persistence)  
**Testing**: Browser-based visual testing, WebAIM contrast checker for accessibility  
**Target Platform**: Web browsers (Chrome, Firefox, Safari, mobile browsers)  
**Project Type**: Web application (frontend-only changes)  
**Performance Goals**: Theme switching <1 second, instant CSS updates via browser rendering  
**Constraints**: WCAG 2.1 Level AA compliance (4.5:1 contrast ratio for normal text, 3:1 for large text)  
**Scale/Scope**: 4 total themes (existing: Light, Dark; new: Green, Green Dark), affects all UI components

## Constitution Check (Pre-Design)

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### I. Specification-First Development ✅
- **Status**: PASS
- **Evidence**: Feature specification in `spec.md` includes 3 prioritized user stories (P1-P3), Given-When-Then acceptance scenarios, clear scope boundaries, and out-of-scope declarations
- **Compliance**: Specification was created before planning phase, following canonical template

### II. Template-Driven Workflow ✅
- **Status**: PASS
- **Evidence**: This plan follows the canonical `plan-template.md` structure. All workflow artifacts (spec.md, research.md, data-model.md, contracts/, quickstart.md) follow prescribed templates
- **Compliance**: No custom sections added; all mandatory sections completed

### III. Agent-Orchestrated Execution ✅
- **Status**: PASS
- **Evidence**: Planning workflow executed by `speckit.plan` agent. Implementation will follow with `speckit.tasks` and `speckit.implement` agents
- **Compliance**: Clear handoffs between agents via well-defined artifacts (spec → plan → tasks → implementation)

### IV. Test Optionality with Clarity ✅
- **Status**: PASS
- **Evidence**: Tests are not mandated by the feature specification. Visual and accessibility validation is recommended but follows existing patterns. No unit/integration tests required for CSS-only changes
- **Compliance**: Tests remain optional; implementation can proceed with manual validation and existing testing infrastructure

### V. Simplicity and DRY ✅
- **Status**: PASS
- **Evidence**: Implementation extends existing theme system architecture without introducing new complexity. Reuses CSS custom property pattern, existing useAppTheme hook structure, and localStorage persistence mechanism
- **Compliance**: No premature abstractions; follows existing patterns established by current light/dark theme implementation

## Project Structure

### Documentation (this feature)

```text
specs/[###-feature]/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
frontend/
├── src/
│   ├── index.css              # CSS custom properties and theme classes
│   ├── hooks/
│   │   └── useAppTheme.ts     # Theme state management hook (to be refactored)
│   ├── components/
│   │   └── ThemeSelector.tsx  # New theme selector component
│   ├── types/
│   │   └── theme.ts           # New TypeScript type definitions
│   └── pages/
│       └── Settings.tsx       # Settings page (add ThemeSelector)
└── tests/
    └── (optional manual testing)
```

**Structure Decision**: This is a web application with frontend-only changes. The feature extends the existing theme system by:
1. Adding new CSS classes for green themes in `index.css`
2. Refactoring `useAppTheme` hook to support multiple themes (not just boolean dark/light)
3. Creating a new `ThemeSelector` component for the UI
4. Adding TypeScript type definitions for type safety
5. Integrating the theme selector into an existing settings page

No backend changes required as theme preferences are stored client-side in localStorage.

## Complexity Tracking

> **No violations to report** - All constitution principles are satisfied. The implementation follows existing patterns and introduces no additional complexity.

## Phase 0: Research (Completed)

**Artifacts Generated**:
- ✅ `research.md` - 8 technology decisions documented with alternatives and rationale

**Key Decisions**:
1. Green color palette selection (GitHub's proven green shades)
2. CSS variable pattern extension (class-based theming)
3. Theme state management (enum strings vs. booleans)
4. Theme selector UI component (radio buttons with visual previews)
5. Persistence strategy (localStorage with backward compatibility)
6. Instant theme application (existing React + CSS mechanism)
7. Accessibility validation (WebAIM contrast checker)
8. Fallback behavior (graceful degradation for invalid data)

**All NEEDS CLARIFICATION items resolved** - No unknowns remain.

## Phase 1: Design (Completed)

**Artifacts Generated**:
- ✅ `data-model.md` - 3 core entities with validation rules
- ✅ `contracts/types.ts` - TypeScript type definitions and type guards
- ✅ `contracts/hook-contract.ts` - React hook interface specification
- ✅ `contracts/css-contract.md` - CSS conventions and accessibility validation
- ✅ `quickstart.md` - 7-step implementation guide with verification

**Key Design Decisions**:
- **ThemeMode**: Type alias for 4 theme options ('light', 'dark', 'green', 'green-dark')
- **ThemePreference**: Interface for persisted user preference with metadata
- **ThemeDefinition**: Complete theme specification with colors and accessibility data
- **CSS Pattern**: Reuse existing custom property names, add new theme-specific classes
- **Hook API**: Extend `useAppTheme` to return `theme`, `setTheme`, `isThemeActive` while maintaining backward compatibility

**Accessibility Compliance**:
- Green light theme: All combinations meet 4.5:1+ contrast ratio (WCAG AA)
- Green dark theme: All combinations meet 4.5:1+ contrast ratio (WCAG AA)
- Documented in contracts/css-contract.md with specific validation results

## Constitution Check (Post-Design)

### I. Specification-First Development ✅
- **Status**: PASS (unchanged)
- **Evidence**: Design artifacts align with specification requirements. All 7 functional requirements (FR-001 to FR-007) are addressed in design phase

### II. Template-Driven Workflow ✅
- **Status**: PASS (unchanged)
- **Evidence**: All Phase 0 and Phase 1 artifacts follow prescribed formats. research.md, data-model.md, contracts/, and quickstart.md all adhere to templates

### III. Agent-Orchestrated Execution ✅
- **Status**: PASS (unchanged)
- **Evidence**: Planning completed by `speckit.plan` agent. Ready for handoff to `speckit.tasks` agent for task decomposition, then `speckit.implement` for execution

### IV. Test Optionality with Clarity ✅
- **Status**: PASS (unchanged)
- **Evidence**: quickstart.md includes manual validation steps and accessibility testing guidance. No automated tests required for CSS-only changes. Existing visual testing patterns sufficient

### V. Simplicity and DRY ✅
- **Status**: PASS (unchanged)
- **Evidence**: Design extends existing patterns without adding complexity:
  - CSS: Reuses existing custom property names, adds new theme classes
  - Hook: Refactors from boolean to enum, maintains backward compatibility
  - Component: Single-responsibility ThemeSelector, follows existing component patterns
  - No new external dependencies required

**Final Status**: ✅ ALL CONSTITUTION PRINCIPLES SATISFIED

## Next Steps

**Phase 2**: Task Generation (`/speckit.tasks` command)
- Generate `tasks.md` with step-by-step implementation tasks
- Organize tasks by user story (P1, P2, P3)
- Define task dependencies and execution order

**Phase 3**: Implementation (`/speckit.implement` command)
- Execute tasks in dependency order
- Follow quickstart.md implementation guide
- Validate against acceptance scenarios in spec.md

## Summary

The green theme implementation plan is complete with all research and design artifacts generated. The implementation:
- Extends existing theme architecture without introducing complexity
- Meets all WCAG 2.1 Level AA accessibility requirements
- Maintains backward compatibility with existing code
- Follows all constitution principles and project conventions
- Is ready for task generation and implementation phases

**Key Deliverables**:
1. Research: 8 technology decisions resolved
2. Design: 3 data entities, 3 contract documents, 1 implementation guide
3. Constitution: All principles satisfied pre and post-design
4. Artifacts: 5 markdown files ready for implementation handoff
