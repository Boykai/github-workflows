# Implementation Plan: Settings Page — Dynamic Value Fetching, Caching, and UX Simplification

**Branch**: `012-settings-dynamic-ux` | **Date**: 2026-02-28 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/012-settings-dynamic-ux/spec.md`

## Summary

Redesign the Settings page to dynamically fetch and cache model options from external providers (starting with GitHub Copilot), simplify the page layout by grouping primary settings prominently and collapsing advanced settings, and handle loading/error/rate-limit states gracefully. The backend introduces a provider-abstracted model-fetching service with TTL-based caching, while the frontend uses TanStack Query's built-in cache and stale-while-revalidate patterns to deliver instant loads with background refreshes.

## Technical Context

**Language/Version**: Python 3.11 (backend), TypeScript 5.x (frontend)
**Primary Dependencies**: FastAPI, React 18, TanStack Query v5, shadcn/ui, Tailwind CSS
**Storage**: SQLite via aiosqlite (existing), in-memory TTL cache (new backend cache layer)
**Testing**: pytest + pytest-asyncio (backend), Vitest (frontend unit), Playwright (frontend e2e)
**Target Platform**: Web application (Linux server backend, browser frontend)
**Project Type**: web (backend + frontend)
**Performance Goals**: Dynamic dropdowns populated within 3s on first load; cached values rendered in <500ms
**Constraints**: Respect GitHub API rate limits (5000 req/hr authenticated); cache TTL 5–15 minutes configurable; Settings page usable on 320px–2560px viewports
**Scale/Scope**: Single-instance application; ~4 primary settings groups; 2+ model providers (GitHub Copilot default, Azure OpenAI existing)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Specification-First | ✅ PASS | spec.md exists with prioritized user stories (P1–P3), GWT acceptance scenarios, edge cases, and success criteria |
| II. Template-Driven Workflow | ✅ PASS | All artifacts follow canonical templates from `.specify/templates/` |
| III. Agent-Orchestrated Execution | ✅ PASS | Plan generated by speckit.plan agent; tasks will be generated by speckit.tasks |
| IV. Test Optionality | ✅ PASS | Tests not mandated in spec; will be included only if requested during tasks phase |
| V. Simplicity and DRY | ✅ PASS | Design favors provider interface abstraction (justified: two providers already exist); reuses TanStack Query cache instead of building custom cache layer on frontend |

**Gate Result**: PASS — No violations. Proceed to Phase 0.

## Project Structure

### Documentation (this feature)

```text
specs/012-settings-dynamic-ux/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
│   └── settings-api.yaml
└── tasks.md             # Phase 2 output (speckit.tasks — NOT created by speckit.plan)
```

### Source Code (repository root)

```text
backend/
├── src/
│   ├── api/
│   │   └── settings.py           # Extend with /settings/models/{provider} endpoint
│   ├── models/
│   │   └── settings.py           # Add ModelOption, FetchState, provider enums
│   ├── services/
│   │   ├── completion_providers.py  # Existing — reference for provider patterns
│   │   ├── github_auth.py           # Existing — token management for API calls
│   │   └── model_fetcher.py         # NEW: Provider-abstracted model fetching + cache
│   └── migrations/                  # No new migrations needed (cache is in-memory)

frontend/
├── src/
│   ├── components/
│   │   ├── settings/
│   │   │   ├── GlobalSettings.tsx      # Refactor: split into primary/advanced sections
│   │   │   ├── SettingsSection.tsx      # Existing reusable wrapper
│   │   │   ├── DynamicDropdown.tsx      # NEW: dropdown with loading/error/cache states
│   │   │   ├── PrimarySettings.tsx      # NEW: model provider, chat model, agent model, Signal
│   │   │   └── AdvancedSettings.tsx     # NEW: collapsible section for secondary settings
│   │   └── ui/                          # Existing shadcn/ui components
│   ├── hooks/
│   │   ├── useSettings.ts              # Extend with useModelOptions() hook
│   │   └── useSettingsForm.ts          # Existing — unchanged
│   ├── pages/
│   │   └── SettingsPage.tsx            # Refactor: reorganize layout sections
│   └── services/
│       └── api.ts                      # Extend settingsApi with fetchModels()
```

**Structure Decision**: Web application structure (existing `backend/` + `frontend/` layout). No new top-level directories. Changes are additive to existing modules, with new files only for the model fetcher service and dynamic dropdown component.

## Constitution Check — Post-Design Re-evaluation

*Re-check after Phase 1 design completion.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Specification-First | ✅ PASS | All design artifacts trace back to spec.md user stories and requirements |
| II. Template-Driven Workflow | ✅ PASS | plan.md, research.md, data-model.md, quickstart.md, contracts/ all follow template structure |
| III. Agent-Orchestrated Execution | ✅ PASS | Plan output is complete; tasks.md deferred to speckit.tasks agent |
| IV. Test Optionality | ✅ PASS | No tests mandated; test infrastructure documented in quickstart for optional use |
| V. Simplicity and DRY | ✅ PASS | Provider interface is minimal (1 method); reuses existing TanStack Query cache; no new database tables; in-memory cache chosen over heavier alternatives |

**Gate Result**: PASS — No violations. Ready for Phase 2 (speckit.tasks).

## Complexity Tracking

> No Constitution Check violations — this section is intentionally empty.

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| — | — | — |
